# General Chartbook Generator

This directory contains the code to generate a **6-page aggregate-level PDF chartbook** analyzing relative Trump tariff advantages across countries and products.

## Purpose

The general chartbook provides high-level summaries of the impact of U.S. tariff actions on relative market access conditions. Unlike the country-by-country chartbook (in `/code/chartbook/`), this version focuses exclusively on aggregate analysis showing:

1. Effective tariff rates for top 20 countries
2. Relative tariff advantages for top 20 countries
3. Product-level example (Switzerland)
4. Hypothetical tariff revenue by country (top 20)
5. Hypothetical tariff revenue by product (top 10)

## Key Differences from Country-by-Country Chartbook

| Feature | General Chartbook | Country-by-Country Chartbook |
|---------|------------------|------------------------------|
| **Focus** | Aggregate-only, high-level summaries | Individual country pages with detailed product breakdowns |
| **Pages** | Fixed 6 pages | 6-page summary + 2 pages per country |
| **Input Files** | 4 aggregate PNG charts | Aggregate charts + country-specific Excel files and product charts |
| **Output Location** | `results/chartbooks_general/` | `results/chart_books/` |
| **Use Case** | Executive summary, overview document | Comprehensive country-specific analysis |

## Directory Structure

```
chartbook_general/
├── generate_chartbook_general.R   # Main generation script
├── demo.R                          # Demo/test script
├── README.md                       # This file
└── styling/
    ├── general_template.Rmd        # R Markdown template (6-page structure)
    ├── preamble.tex                # LaTeX styling
    └── *.png                       # Logo files (GTA, SECO, C4TP)
```

## Requirements

### Software Dependencies

- **R** (version 4.0 or higher)
- **R Packages**: `rmarkdown`, `knitr` (auto-installed if missing)
- **LaTeX Distribution**:
  - macOS: [MacTeX](https://www.tug.org/mactex/)
  - Windows: [MiKTeX](https://miktex.org/)
  - Linux: TeX Live (`sudo apt-get install texlive-full`)

### Required Input Files

The following charts must exist in `results/aggregates/`:

1. `effective_rates_top20.png` - Trade-weighted effective tariff rates by country
2. `relative_advantage_top20.png` - Relative tariff advantage by country
3. `hypothetical_tariff_revenue_top20.png` - Revenue projections by country
4. `hypothetical_tariff_revenue_by_product_top10.png` - Revenue projections by product

These files are generated by the main data processing pipeline (specifically by `country_group_analysis.R` or similar aggregate analysis scripts).

## Usage

### Quick Start (Demo)

```r
# Navigate to the chartbook_general directory
setwd("code/chartbook_general")

# Run the demo script
source("demo.R")
```

The demo script will:
1. Validate all required input files exist
2. Check for LaTeX installation
3. Generate a demo chartbook with current date
4. Print paths to generated files

### Standard Usage

```r
# Load the generation function
source("generate_chartbook_general.R")

# Generate chartbook with custom parameters
result <- generate_chartbook_general(
  output_name = "GTA - Trump Tariff Advantage - Chart Book",
  policy_date = "14 October 2025",
  update_date = "26 November 2025"
)

# Access generated files
print(result$pdf)          # Path to PDF
print(result$output_dir)   # Output directory
print(result$zip)          # ZIP archive
```

### Function Parameters

```r
generate_chartbook_general(
  output_name = "GTA - Trump Tariff Advantage - Chart Book",  # PDF filename (without .pdf)
  policy_date = "14 October 2025",                            # Policy effective date
  update_date = format(Sys.Date(), "%d %B %Y"),               # Document version date
  aggregates_dir = "../../results/aggregates",                # Input chart directory
  output_dir = "../../results/chartbooks_general",            # Output base directory
  template_dir = "styling"                                    # Template directory
)
```

## Output Structure

After generation, the output directory contains:

```
results/chartbooks_general/general_YYMMDD-HHMM/
├── GTA - Trump Tariff Advantage - Chart Book.pdf              # Main PDF
├── GTA - Trump Tariff Advantage - Data & Charts - YYMMDD.zip  # ZIP archive
├── data & charts/                                             # All input charts
│   ├── effective_rates_top20.png
│   ├── relative_advantage_top20.png
│   ├── hypothetical_tariff_revenue_top20.png
│   └── hypothetical_tariff_revenue_by_product_top10.png
└── aux/                                                       # LaTeX files and logos
    ├── general_template.tex
    ├── general_template.log
    ├── preamble.tex
    └── *.png (logos)
```

## Chartbook Content

### Page 1: Cover & Introduction
- Title page with three organization logos (GTA, SECO, C4TP)
- Introduction explaining the purpose and scope
- Table of contents

### Page 2: Effective Rates
- Narrative explaining trade-weighted effective tariff rates
- Chart showing top 20 countries by effective rate

### Page 3: Relative Tariff Advantage
- Explanation of relative advantage metric
- Diverging bar chart (green = advantage, red = disadvantage)
- Top 20 countries ranked by advantage

### Page 4: Product-Level Analysis
- Discussion of product-level variation
- Example chart: Switzerland's top 10 products (placeholder)

### Page 5: Hypothetical Revenue by Country
- Methodology and caveats
- Top 20 countries by hypothetical tariff revenue

### Page 6: Hypothetical Revenue by Product
- Top 10 products by hypothetical tariff revenue
- HS 8-digit level analysis

## Customization

### Modifying the Template

The R Markdown template can be customized by editing:
- `styling/general_template.Rmd` - Content, structure, narrative text
- `styling/preamble.tex` - LaTeX formatting, fonts, colors, page layout

### Adding Country-Specific Product Charts

To include a specific country's product chart (e.g., Switzerland):
1. Generate the chart: `switzerland_top10_products.png`
2. Place it in `results/aggregates/`
3. The template will automatically include it on Page 4

### Changing Logos

Replace logo files in `styling/`:
- `GTA_logo.png` - Global Trade Alert
- `SECO_logo.png` - State Secretariat for Economic Affairs
- `C4TP_logo.png` - Coalition for Trade Policy

## Troubleshooting

### "Missing required charts"
Ensure all 4 aggregate charts exist in `results/aggregates/`. Generate them by running the upstream data processing pipeline.

### "LaTeX installation not found"
Install a LaTeX distribution for your operating system (see Requirements section).

### "PDF generation failed"
Check the log file in `aux/` directory for detailed LaTeX errors. Common issues:
- Missing fonts (install Roboto font family)
- Corrupted PNG files (regenerate charts)
- LaTeX package conflicts (update LaTeX distribution)

### Template rendering errors
Ensure R packages are up to date:
```r
update.packages(c("rmarkdown", "knitr"))
```

## Integration with Main Pipeline

This chartbook is typically generated after:
1. Data processing (`data_processing.R`)
2. Tariff calculations (`us_tariff_calculation.R`)
3. **Aggregate analysis** (`country_group_analysis.R` or similar)

To integrate into your workflow:
```r
# After aggregate analysis is complete
source("code/chartbook_general/generate_chartbook_general.R")
generate_chartbook_general(
  policy_date = POLICY_DATE_LONG,
  update_date = UPDATE_DATE_LONG
)
```

## Contact

For questions or issues:
- **Author**: Johannes Fritz, St.Gallen Endowment
- **Project**: Global Trade Alert - Relative Trump Tariff Advantage Analysis
- **Website**: https://www.globaltradealert.org

## License

This code is part of the Global Trade Alert project replication files.
